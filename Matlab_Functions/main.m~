%% Initialize and import data
clc;clear;
nuclear_capacity  = 54000;
percent_operation = 0.95;
load('load.mat');
loads = ERCOT;
time  = linspace(0,23,24);  % have not figure out how to import time into matlab

%% Start optimization
A   = [];
b   = [];
Aeq = [];
beq = [];
lb  = [];
ub  = [];
nonlcon = @(gen)non_linear_constraints(gen,time,loads);
guess   = nuclear_capacity * percent_operation * ones(length(time),1);
options = optimoptions('fmincon', ...
        'Algorithm', 'sqp', ...  % choose one of: 'interior-point', 'sqp', 'active-set', 'trust-region-reflective'
        'Display', 'iter-detailed', ...  % display more information
        'MaxIterations', 1e5, ...  % maximum number of iterations
        'MaxFunctionEvaluations', 1e8, ...  % maximum number of function calls
        'StepTolerance',1e-8, ...
        'OptimalityTolerance', 1e-6, ...  % convergence tolerance on first order optimality
        'ConstraintTolerance', 1e-6, ...  % convergence tolerance on constraints
        'FiniteDifferenceType', 'forward', ...  % if finite differencing, can also use central
        'Diagnostics', 'on'); % display diagnotic information
[gen_opt, cost_opt, exitflag, ~] = fmincon(@(gen)obj(gen,time,loads),guess,A,b,Aeq,beq,lb,ub,nonlcon,options);

%% Plotting
[cost_compare, T_compare] = model(guess, time, loads);
[cost_opt, T_opt] = model(gen_opt, time, loads);
figure;
box on;
hold on;
plot(time,T_compare,'r-');
plot(time,T_opt,'b-');

